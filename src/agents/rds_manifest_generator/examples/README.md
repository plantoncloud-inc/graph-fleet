# Example AWS RDS Manifests

This directory contains example YAML manifests generated by the AWS RDS Manifest Generator agent.

## Examples

### production-postgres.yaml

**Use Case**: Production-grade PostgreSQL database for API backend

**Configuration Highlights**:
- **Engine**: PostgreSQL 15.5 (latest stable version)
- **Instance**: `db.m6g.large` (2 vCPU, 8 GB RAM)
- **Storage**: 100 GB encrypted
- **High Availability**: Multi-AZ enabled for 99.95% SLA
- **Security**: Private network only, encrypted at rest
- **Cost**: ~$280/month (Multi-AZ)

**Best For**:
- Production APIs with medium traffic (1K-10K requests/min)
- Applications requiring high availability
- Workloads with balanced compute/memory needs

**Before Deploying**:
1. Replace `REPLACE_WITH_SECURE_PASSWORD` with strong password
2. Update subnet IDs with your VPC subnets (need 2+ in different AZs)
3. Update security group ID with your configured SG
4. Adjust storage size based on data volume

---

### dev-mysql.yaml

**Use Case**: Development MySQL database for testing

**Configuration Highlights**:
- **Engine**: MySQL 8.0
- **Instance**: `db.t3.micro` (1 vCPU, 1 GB RAM)
- **Storage**: 20 GB unencrypted
- **High Availability**: Single-AZ (cost savings)
- **Security**: Private network only
- **Cost**: ~$12/month (single-AZ)

**Best For**:
- Development and testing environments
- Learning and experimentation
- Non-critical workloads
- Cost-sensitive scenarios

**Before Deploying**:
1. Verify subnet IDs exist in your development VPC
2. Ensure security group allows access from dev resources
3. Consider using placeholder password (not production data)

---

### ha-mariadb.yaml

**Use Case**: Enterprise-grade MariaDB for analytics workloads

**Configuration Highlights**:
- **Engine**: MariaDB 10.11
- **Instance**: `db.r6g.xlarge` (4 vCPU, 32 GB RAM)
- **Storage**: 1 TB encrypted with custom KMS key
- **High Availability**: Multi-AZ with 3 subnet deployment
- **Security**: Private network, dual security groups, custom KMS
- **Advanced**: Custom parameter and option groups
- **Cost**: ~$560/month (Multi-AZ, memory-optimized)

**Best For**:
- Large-scale analytics and reporting
- Memory-intensive queries
- Enterprise compliance requirements
- Mission-critical data processing

**Before Deploying**:
1. Replace password with secure credential from secrets manager
2. Update KMS key ARN with your organization's key
3. Verify all 3 subnet IDs are in different availability zones
4. Ensure custom parameter/option groups exist
5. Configure security groups for appropriate access patterns

---

## Field Reference

### Required Fields

All manifests must include these fields:

- `apiVersion`: Always `aws.project-planton.org/v1`
- `kind`: Always `AwsRdsInstance`
- `metadata.name`: Unique resource identifier
- `metadata.org`: Organization name
- `metadata.env`: Environment name
- `spec.engine`: Database engine type
- `spec.engineVersion`: Specific version
- `spec.instanceClass`: Instance size (must start with "db.")
- `spec.allocatedStorageGb`: Storage in GB (must be > 0)
- `spec.username`: Master username
- `spec.password`: Master password
- `spec.subnetIds`: List of VPC subnet IDs (2+ for Multi-AZ)
- `spec.securityGroupIds`: List of security group IDs

### Common Optional Fields

- `spec.port`: Database port (defaults: PostgreSQL=5432, MySQL/MariaDB=3306)
- `spec.publiclyAccessible`: Assign public IP (default: false, recommended: false)
- `spec.multiAz`: Enable Multi-AZ (default: false, recommended: true for production)
- `spec.storageEncrypted`: Enable encryption (default: false, recommended: true for production)
- `spec.kmsKeyId`: Custom KMS key (requires storageEncrypted=true)
- `spec.parameterGroupName`: Custom DB parameter group
- `spec.optionGroupName`: Custom DB option group
- `spec.dbSubnetGroupName`: Existing subnet group to use

### Metadata Labels

Labels are optional but recommended for organization:

```yaml
metadata:
  labels:
    environment: production | staging | development
    team: backend | frontend | data | platform
    service: api | analytics | cache
    cost-center: engineering | sales | marketing
    compliance: pci | hipaa | sox
```

## Deployment

### Using Planton Cloud CLI

```bash
# Validate manifest
planton validate -f production-postgres.yaml

# Deploy
planton apply -f production-postgres.yaml

# Check status
planton get rds production-api-db
```

### Using kubectl-style Commands

```bash
# Apply manifest
kubectl apply -f production-postgres.yaml

# Get resources
kubectl get awsrdsinstance

# Describe specific instance
kubectl describe awsrdsinstance production-api-db

# Delete instance
kubectl delete -f production-postgres.yaml
```

## Customization Guide

### Scaling Up/Down

To change instance size, update `instanceClass`:

```yaml
# From small to large
instanceClass: db.m6g.large  # 2 vCPU, 8 GB RAM
# to
instanceClass: db.m6g.xlarge  # 4 vCPU, 16 GB RAM
```

Common instance families:
- **T3**: Burstable, cost-effective for variable workloads
- **M6g**: General purpose, balanced compute/memory
- **R6g**: Memory optimized for large datasets
- **C6g**: Compute optimized for high CPU workloads

### Adding Encryption

```yaml
spec:
  storageEncrypted: true
  kmsKeyId: arn:aws:kms:REGION:ACCOUNT:key/KEY_ID  # Optional: use custom key
```

### Enabling Multi-AZ

```yaml
spec:
  multiAz: true
  subnetIds:  # Need 2+ subnets in different AZs
    - subnet-1a
    - subnet-1b
```

### Adjusting Storage

```yaml
spec:
  allocatedStorageGb: 100  # Minimum 20, maximum 65536
```

Storage can be increased without downtime, but cannot be decreased.

## Security Best Practices

1. **Never commit passwords**: Use placeholder values, inject at deploy time
2. **Use KMS encryption**: Enable `storageEncrypted: true` for production
3. **Private networking**: Keep `publiclyAccessible: false`
4. **Security groups**: Restrict to minimum necessary access
5. **Multi-AZ**: Enable for production workloads
6. **Regular backups**: Configure automated backups (not in manifest)
7. **Least privilege**: Database user permissions outside of manifest

## Cost Optimization

### Development Environments

- Use `db.t3.micro` or `db.t3.small`
- Single-AZ deployment (skip `multiAz`)
- Skip encryption if not handling sensitive data
- Use minimal storage (20-50 GB)
- **Estimated**: $12-50/month

### Production Environments

- Use appropriate instance size (m6g or r6g families)
- Enable Multi-AZ for HA
- Enable encryption
- Size storage appropriately (avoid over-provisioning)
- **Estimated**: $140-1000+/month depending on size

### Savings Tips

1. **Reserved Instances**: Commit to 1-3 years for 30-60% savings
2. **Right-sizing**: Monitor and adjust instance class based on actual usage
3. **Storage optimization**: Use GP3 instead of GP2 when available
4. **Delete unused instances**: Don't forget about dev/test databases

## Troubleshooting

### Deployment Failures

**Subnet not found**
- Verify subnet IDs exist in your VPC
- Check subnet IDs are in correct region
- Ensure subnets are in different AZs for Multi-AZ

**Security group error**
- Verify security group IDs exist
- Check security group is in same VPC as subnets

**KMS key error**
- Verify KMS key ARN is correct
- Check you have permission to use the key
- Ensure key is in same region

**Parameter group error**
- Verify parameter group exists
- Check it's compatible with engine version
- Ensure it's in same region

### Validation Errors

**instanceClass must start with "db."**
- Change `t3.micro` to `db.t3.micro`

**allocatedStorageGb must be > 0**
- Provide positive integer for storage size

**Need at least 2 subnets for Multi-AZ**
- Add second subnet ID to `subnetIds` list
- Or disable Multi-AZ

## Next Steps

1. **Generate your own**: Use the agent to create custom manifests
2. **Read the docs**: See [USER_GUIDE.md](../USER_GUIDE.md) for conversation examples
3. **Try the agent**: Run `make run` and chat with the agent
4. **Learn more**: Check [DEVELOPER_GUIDE.md](../DEVELOPER_GUIDE.md) for technical details

## Questions?

- **User Guide**: [USER_GUIDE.md](../USER_GUIDE.md)
- **Quick Start**: [QUICKSTART.md](../QUICKSTART.md)
- **Demos**: [DEMO_SCENARIOS.md](../DEMO_SCENARIOS.md)
- **Integration**: [INTEGRATION.md](../INTEGRATION.md)

